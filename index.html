<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description"
        content="Cosmic Clash - An exciting space shooter game. Battle through waves of enemies and collect powerups!">
    <meta name="theme-color" content="#0a0a20">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>Cosmic Clash | Space Shooter</title>

    <!-- Preconnect to external resources -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Press+Start+2P&display=swap"
        rel="stylesheet">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <!-- Animated Background -->
    <div class="stars" aria-hidden="true"></div>
    <div class="twinkling" aria-hidden="true"></div>

    <!-- Mobile Header Stats Bar -->
    <div class="mobile-stats-bar" id="mobile-stats-bar">
        <div class="mobile-stat">
            <span class="mobile-stat-label">SCORE</span>
            <span id="mobile-score" class="mobile-stat-value">0</span>
        </div>
        <div class="mobile-stat">
            <span class="mobile-stat-label">LVL</span>
            <span id="mobile-level" class="mobile-stat-value">1</span>
        </div>
        <div class="mobile-stat mobile-health-container">
            <div class="mobile-health-bar">
                <div id="mobile-health" class="mobile-health-fill"></div>
            </div>
        </div>
        <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle menu">
            <span class="menu-icon">‚ò∞</span>
        </button>
    </div>

    <!-- Main Game Container -->
    <div class="game-container">
        <!-- Sidebar - Game Stats & Controls -->
        <aside class="sidebar" id="sidebar" role="complementary" aria-label="Game statistics and controls">
            <!-- Close button for mobile -->
            <button class="sidebar-close" id="sidebar-close" aria-label="Close menu">√ó</button>

            <!-- Stats Panel -->
            <div class="stats-panel glass-card">
                <h1 class="game-title">COSMIC CLASH</h1>

                <div class="stat-item">
                    <span class="stat-label">SCORE</span>
                    <span id="score" class="stat-value" aria-live="polite" aria-atomic="true">0</span>
                </div>

                <div class="stat-item">
                    <span class="stat-label">LEVEL</span>
                    <span id="level" class="stat-value" aria-live="polite" aria-atomic="true">1</span>
                </div>

                <div class="stat-item">
                    <span class="stat-label">HEALTH</span>
                    <div class="health-bar" role="progressbar" aria-label="Health" aria-valuemin="0" aria-valuemax="100"
                        aria-valuenow="100">
                        <div id="health" class="health-fill" style="width: 100%;"></div>
                    </div>
                </div>

                <div class="stat-item">
                    <span class="stat-label">POWER</span>
                    <div class="power-bar" role="progressbar" aria-label="Power" aria-valuemin="0" aria-valuemax="100"
                        aria-valuenow="0">
                        <div id="power" class="power-fill" style="width: 0%;"></div>
                    </div>
                </div>

                <div class="powerups">
                    <h4>ACTIVE POWERUPS</h4>
                    <div id="powerups-list" class="powerups-list" aria-live="polite" aria-label="Active powerups"></div>
                </div>
            </div>

            <!-- Game Controls -->
            <div class="controls-panel glass-card">
                <button id="start-btn" class="btn btn-neon" aria-label="Start game">
                    <span class="btn-text">START GAME</span>
                </button>
                <button id="pause-btn" class="btn btn-neon" aria-label="Pause game" disabled>
                    <span class="btn-text">PAUSE</span>
                </button>

                <div class="volume-control">
                    <label for="volume" class="control-label">VOLUME</label>
                    <input type="range" id="volume" min="0" max="1" step="0.1" value="0.7" aria-label="Volume control"
                        aria-valuemin="0" aria-valuemax="100" aria-valuenow="70">
                    <span id="volume-display" class="volume-display" aria-live="polite">70%</span>
                </div>

                <!-- Controls Info -->
                <div class="controls-info">
                    <h5>CONTROLS</h5>
                    <p class="control-info">
                        <span class="desktop-only">üñ±Ô∏è Move: Mouse<br>üî´ Shoot: Click/Space</span>
                        <span class="mobile-only">üëÜ Touch to move<br>üî´ Auto-shoot</span>
                    </p>
                </div>
            </div>
        </aside>

        <!-- Sidebar Overlay for mobile -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- Game Canvas Container -->
        <main class="canvas-container" role="main" aria-label="Game area">
            <canvas id="gameCanvas" aria-label="Space shooter game canvas">
                Your browser does not support the canvas element. Please use a modern browser.
            </canvas>

            <!-- Game Over Panel -->
            <div id="game-over" class="game-over-panel" role="dialog" aria-labelledby="game-over-title"
                aria-modal="true">
                <h2 id="game-over-title">GAME OVER</h2>
                <p>Final Score: <span id="final-score" class="highlight-score">0</span></p>
                <p id="high-score-message" class="high-score-msg"></p>
                <button id="restart-btn" class="btn btn-neon" aria-label="Restart game">
                    <span class="btn-text">PLAY AGAIN</span>
                </button>
            </div>

            <!-- Level Up Panel -->
            <div id="level-up" class="level-up-panel" role="dialog" aria-labelledby="level-up-title" aria-modal="true">
                <h2 id="level-up-title">LEVEL COMPLETE!</h2>
                <p>Advancing to level <span id="next-level" class="highlight-score">2</span></p>
                <p class="level-bonus">Bonus: +<span id="level-bonus">500</span></p>
            </div>

            <!-- Loading Indicator -->
            <div id="loading" class="loading-panel">
                <div class="loading-spinner"></div>
                <p>Loading Game...</p>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/particles.js"></script>
    <script src="js/game.js"></script>

    <script>
        // Mobile Menu Toggle
        document.addEventListener('DOMContentLoaded', function () {
            const sidebar = document.getElementById('sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const sidebarClose = document.getElementById('sidebar-close');

            function openSidebar() {
                sidebar.classList.add('active');
                sidebarOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            function closeSidebar() {
                sidebar.classList.remove('active');
                sidebarOverlay.classList.remove('active');
                document.body.style.overflow = '';
            }

            if (mobileMenuToggle) {
                mobileMenuToggle.addEventListener('click', openSidebar);
            }

            if (sidebarClose) {
                sidebarClose.addEventListener('click', closeSidebar);
            }

            if (sidebarOverlay) {
                sidebarOverlay.addEventListener('click', closeSidebar);
            }

            // Canvas resize logic
            const canvas = document.getElementById('gameCanvas');
            const container = document.querySelector('.canvas-container');

            function resizeCanvas() {
                const containerWidth = container.clientWidth;
                const containerHeight = container.clientHeight;
                const isMobile = window.innerWidth <= 768;

                let canvasWidth, canvasHeight;

                if (isMobile) {
                    // Full screen on mobile
                    canvasWidth = containerWidth;
                    canvasHeight = containerHeight;
                } else {
                    // Maintain aspect ratio on desktop
                    const aspectRatio = 16 / 9;
                    canvasWidth = containerWidth;
                    canvasHeight = containerWidth / aspectRatio;

                    if (canvasHeight > containerHeight) {
                        canvasHeight = containerHeight;
                        canvasWidth = containerHeight * aspectRatio;
                    }
                }

                canvas.width = canvasWidth;
                canvas.height = canvasHeight;

                window.dispatchEvent(new CustomEvent('canvasResized', {
                    detail: { width: canvasWidth, height: canvasHeight }
                }));
            }

            resizeCanvas();

            let resizeTimeout;
            window.addEventListener('resize', function () {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(resizeCanvas, 250);
            });

            window.addEventListener('orientationchange', function () {
                setTimeout(resizeCanvas, 100);
            });

            // Sync mobile stats with main stats
            function syncStats() {
                const score = document.getElementById('score').textContent;
                const level = document.getElementById('level').textContent;
                const health = document.getElementById('health').style.width;

                document.getElementById('mobile-score').textContent = score;
                document.getElementById('mobile-level').textContent = level;
                document.getElementById('mobile-health').style.width = health;
            }

            // Observe changes to main stats
            const observer = new MutationObserver(syncStats);
            observer.observe(document.getElementById('score'), { childList: true, characterData: true, subtree: true });
            observer.observe(document.getElementById('level'), { childList: true, characterData: true, subtree: true });
            observer.observe(document.getElementById('health'), { attributes: true, attributeFilter: ['style'] });

            // Volume display
            const volumeSlider = document.getElementById('volume');
            const volumeDisplay = document.getElementById('volume-display');

            if (volumeSlider && volumeDisplay) {
                volumeSlider.addEventListener('input', function () {
                    volumeDisplay.textContent = Math.round(this.value * 100) + '%';
                });
            }

            // Device detection
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            if (isMobile) {
                document.querySelector('.mobile-only').style.display = 'block';
                document.querySelector('.desktop-only').style.display = 'none';
            } else {
                document.querySelector('.mobile-only').style.display = 'none';
                document.querySelector('.desktop-only').style.display = 'block';
            }

            // Hide loading
            setTimeout(function () {
                const loading = document.getElementById('loading');
                if (loading) loading.style.display = 'none';
            }, 1000);
        });

        // Prevent pull-to-refresh
        document.body.addEventListener('touchmove', function (e) {
            if (e.target === document.body) {
                e.preventDefault();
            }
        }, { passive: false });

        // Prevent context menu
        document.getElementById('gameCanvas').addEventListener('contextmenu', function (e) {
            e.preventDefault();
        });
    </script>
</body>

</html>